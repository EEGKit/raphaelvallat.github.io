<!DOCTYPE HTML>
<!--
	Read Only by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>SleepViz</title>
		<meta charset="utf-8" />
		<meta name="description" content="Raphael Vallat, PhD"/>
		<meta name="author" content="Raphael Vallat, PhD" />
		<meta name="keywords" content="sleepviz, sleep staging, matlab, raphael vallat, toolbox, hypnogram" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="assets/css/academicons.css"/>
		<link rel="shortcut icon" type="image/x-icon" href="favicon.ico">

		<!-- Add Google Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Noto+Sans|Noto+Serif|Roboto+Mono" rel="stylesheet">

		<!--[if lte IE 8]><link rel="stylesheet" href="assets/css/ie8.css" /><![endif]-->
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-118198513-1"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag() {
				dataLayer.push(arguments);
			}
			gtag('js', new Date());
			gtag('config', 'UA-118198513-1');
		</script>
	</head>
	<body>

		<!-- Header -->
			<section id="header">
				<header>
					<!-- <span class="image avatar"><img src="images/avatar.jpg" alt="" /></span> -->
					<h1 id="logo"><a href="#">Raphael Vallat, PhD</a></h1>
					<p>Senior ML data scientist<br>Oura Ring</p>
				</header>
				<nav id="nav">
					<ul>
						<li><a href="index.html#one">About</a></li>
		        <li><a href="index.html#two">Academics</a></li>
		        <li><a href="index.html#three">Publications</a></li>
		        <li><a href="index.html#four">Media</a></li>
		        <li><a href="index.html#five">Softwares</a></li>
		        <li><a href="index.html#six" class="active">Tutorials</a></li>
		      </ul>
				</nav>
				<footer>
					<ul class="icons">
						<li><a href="https://github.com/raphaelvallat" class="icon fa-github" target="_blank"><span class="label">Github</span></a></li>
						<li><a href="mailto:raphaelvallat9@gmail.com" class="icon fa-envelope"><span class="label">Email</span></a></li>
						<li><a href="https://scholar.google.fr/citations?user=XH8IG2UAAAAJ" style="border:none" class="ai ai-google-scholar ai-1x" target="_blank"></a></li>
						<li><a href="https://twitter.com/RaphaelVallat" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
						<li><a href="https://www.linkedin.com/in/raphaelvallat9/" class="icon fa-linkedin"><span class="label">Twitter</span></a></li>
					  </ul>
				</footer>
			</section>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">

					<div class="container">

						<section>
							<header>
								<h3>SleepViz : a Matlab toolbox for visualisation of polysomnographic data</h3>
								<p>February 2017</p>
							</header>
						</section>

						<section>

						<p align="justify">SleepViz is a very simple and naive Matlab-based graphical interface for visualisation of polysomnographic data. I developed it during my PhD in order to have a quick access to my EEG data with their corresponding spectrogram (time-frequency representation) and hypnogram (sleep scoring). I have progressively implemented some other functions such as sleep stats computation, rapid eye movements detection, filtering...but I would like to emphasize that this is more a 'side' project and you should really use it with caution!</p>

						<ul class="feature-icons">
						<li class="fa-code">Link to my <a href="https://github.com/raphaelvallat/SleepViz">SleepViz GitHub repository</a></li><br>
						</ul>

						<ul class="feature-icons">
						<li class="fa-exclamation-triangle">I am now working exclusively on the Sleep project that I am developing with my dear friend <a href="https://etiennecmb.github.io">Etienne Combrisson</a>. Sleep is intended to be a Python-written, more efficient (and beautiful!) open access version of SleepViz. Checkout <a href="https://github.com/EtienneCmb/visbrain">the code</a> or <a href="http://visbrain.org/sleep">documentation.</a></li>
						</ul>

						</section>

						<hr />

						<span class="image fit"><img src="images/tutorials/sleepviz/main_interface.png" alt="" />
						<figcaption>Screenshot of SleepViz main interface</figcaption>
						</span>

						<hr />

						<h4>Running SleepViz</h4>

						<p>Once you have downloaded sleepviz and added it to your Matlab path, just type <b>sleepviz</b> to start the program. In the current version, SleepViz allows input from 2 different formats:
						<ul>
							<li>.edf (using <a href="https://fr.mathworks.com/matlabcentral/fileexchange/31900-edfread">edfRead function</a> by Brett Shoelson, Matlab file exchange</li>
							<li>.eeg (<a href="http://elan.lyon.inserm.fr/">Lyon Neuroscience Research Center in house file format)</a></li>
						</ul>

						After selecting the channels you want to plot, the following windows opens:</p>

						<span class="image"><img src="images/tutorials/sleepviz/sleepviz_params.png" alt="" />
						</span>

						<ul>
							<li><b>Apply downsampling to 100 Hz:</b> by default, SleepViz will downsample your data to 100 Hz to accelerate the computing of the spectrogram. If you prefer not to resample your data, just put 0 in the textbox.</li><br>
							<li><b>Plot spectrogram:</b> requires <a href="https://fr.mathworks.com/products/signal.html">Signal Processing Toolbox</a>. Plot a spectrogram on specified channel using short-time Fourier transform. Spectrogram is  a visual representation of the frequencies spectrum over time. It is especially useful for the scoring of sleep stages which have all different spectral signatures. The default segmentation windows is 10 seconds with an overlap of 0.9. This latter parameter is particularly time-consuming and I recommand putting a lower value if you do not have a powerful computer and/or if you have a dataset of several hours.</li><br>
							<li><b>Plot hypnogram:</b> requires a hypnogram file either in .hyp format (Elan in house format) or .txt. In that case it must contains one column of integer crresponding to the sleep stages. By default, sleepviz will resample the hypnogram to get one value per second. <br>The default hypnogram format of SleepViz is: Wake=0, N1=1, N2=2, N3=3, REM=4, Art=-1 (based on Iber 2007 guidelines).</li>
						</ul>

						After selecting the spectrogram channel and hypnogram files, the main interface of sleepviz will launch. <br> The <b>slider bar</b> at the bottom of the window allow you to move forward or backward (30 sec epochs) in the EEG data. Spectrogram and hypnogram are displayed for the full record and only the PSG data are affected by the slider bar. <br>The <b>Amplitude</b> button allows you to modify the amplitude (in mV) of each individual channels. <br>Finally, the <b>Tools</b> button open a new window with several algorithms detailed below.

						<hr />

						<h3>Tools</h3>
						<h4>REM Auto-Detect</h4>

						<p>A simple semi-automatic algorithm for the detection of Rapid Eye Movements (saccades). <br><br> The method is the following: <br>
						 1) <b>Signal smoothing</b> using either a moving average with a window of 100 ms or a bandpass filter (0.1 - 3 Hz, see Andrillon 2015).
						 <br>2) Computing of the <b>first derivative</b> of the smoothed signal using a 40 ms step. I chose a 40 ms windows since most of naturally occurring human saccades have magnitudes of 15 degrees or less and last thus no more than 30 – 40 ms (the maximum velocity of a saccade is above 500°/sec, see (Bahill et al., 1975). <br>3) Apply a <b>threshold</b> (mean + X standard deviations) on the derivative to allow for an optimal detection of REMs. <br>4) The total number of REMs is then defined as the <b>sum of non-concomitant REMs</b> detected in the two components during REM sleep.</p>
						 <p>
						 When you click on REMs detection, the program asks you to select 2 EOG channels. I would recommend using artefact-free EOG signal (extracted for example using ICA) for a better detection of saccades.</p>

						<span class="image"><img src="images/tutorials/sleepviz/rems_param.png" alt="" /></span>

						<ul>
							<li><b>REM Sleep:</b> uses only epochs scored as REM sleep for the computation of REMs. Requires a hypnogram file.</li>
							<li><b>Filter Type:</b> either a moving average (100 ms windows) or bandpass filter (0.1 - 3 Hz). Bandpass is generally more conservative.</li>
							<li><b>Threshold:</b> threshold is the specified number of standard deviations of the derivative signal. Each supra-threshold cluster will be considered as a unique rapid eye movements. </li>
						</ul>

						After having specified the desired parameters, the following windows will open to allow you for a visual check of the detected REMs. You can move forward or backward using the slider bar. The textbox on the left indicates the number of REMs detected on each EOG components as well as the final number of unique non-concomitant REMs. It is then up to you to change the threshold in order to optimize the detection</p>

						<span class="image fit"><img src="images/tutorials/sleepviz/rems_detection.png" alt="" /></span>

						<p>The script also create a .mat file in the data folder which contains analysis info and results</p>
<pre><code>
RAPID EYE MOVEMENTS AUTO-DETECTION
-----------------------------------------
ANALYSIS INFO
EEG File 	:	excerpt1.edf
Duration 	:	30 minutes
Filter type	:	moving [100 samples]
Threshold 	:	3
Derivative 	:	40 ms

RESULTS
Number 		:	185
Density 	:	6.17 REMs / minutes
Outfile		:	C:\Users\Raphael\Desktop\These\GitHub\SleepViz\examples\DREAMS\REMs_detection_excerpt1_filter_moving_thresh_3.mat
-----------------------------------------------
</code></pre>
					<br>
					<p>The excellent <a href="http://www.tcts.fpms.ac.be/~devuyst/Databases/DatabaseREMs/">DREAMS database</a>, in addition with providing free polysomnographic data and corresponding hypnograms also provides the number of REMs visually scored by an expert. Our method with the default parameters yielded 185 REMs (see output above), a figure quite consistent with the 157 visually-scored REMs!</p>

					<hr />

					<h4>Compute Sleep Stats</h4>

					<p>SleepViz allows to compute sleep statistics of the current hypnogram with the definitions below. If they do not match what you want, you can modify it in the compute_sleep_stats.m function. </p>

					<ul>
					<li><b>Time in Bed (TIB):</b> total duration of the hypnogram in minutes. </li>
					<li><b>Total Dark Time (TDT):</b> duration of the hypnogram from beginning to awakening. This should be used as the reference measure for the computation of sleep stages percentages in cases where the subjects are voluntarily awakened at a certain point in time (i.e. that after this point the subjects interact with the experimenter). If that is not your case, you should use TIB instead of TDT as the reference measure. </li>
					<li><b>Sleep Period Time (SPT):</b> duration (minutes) from first to last period of sleep.</li>
					<li><b>Wake After Sleep Onset:</b> duration (minutes) of wake periods within SPT</li>
					<li><b>Total Sleep Time (TST):</b> SPT - WASO</li>
					<li><b>TST_N2:</b> same as TST but excluding N1 sleep.</li>
					<li><b>Sleep Efficiency (SE):</b> TST / TDT * 100 (%)</li>
					<li><b>Sleep stages:</b> W, N1, N2, N3 and REM sleep expressed in minutes.</li>
					<li><b>%Sleep stages:</b> W, N1, N2, N3 and REM sleep expressed in percentages of TDT.</li>
					<li><b>Latencies:</b> latencies of sleep stages from the beginning of the record expressed in minutes. </li>
					</ul>

					<span class="image"><img src="images/tutorials/sleepviz/sleep_stats.png" alt="" /></span>

					<hr />

					<h4>ECG Analysis</h4>

					<p>The ECG Analysis tool extracts the mean heart rate across the entire record using the findpeaks function from Signal Processing Toolbox. Once you clicked the button, the following window appears:</p>

					<span class="image"><img src="images/tutorials/sleepviz/ecg_params.png" alt="" /></span>

					<br>

					<p>Once you specified the ECG channel and desired parameters, a graphical interface opens to let you explore the detected peaks in ECG signal. In parallel, the main ECG structure , containg analysis parameters and the number of detected peaks per epoch and minutes is saved in your original data folder. </p>
					<span class="image fit"><img src="images/tutorials/sleepviz/ecg.png" alt="" /></span>

					<hr />

					<h4>Filter signal</h4>

					<p>A simple bandpass filter (requires Signal Processing Toolbox). You simply need to enter the cut-off frequencies and butterworth order. </p>

					<span class="image fit"><img src="images/tutorials/sleepviz/filter.png" alt="" />
					<figcaption>Signal filtered in band 11 - 16 Hz</figcaption>
					</span>

					</div>

				<!-- Footer -->
					<section id="footer">
						<div class="container">
							<ul class="copyright">
								<li>&copy; Raphael Vallat </li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li><li>Banner image: Nicholas Roerich</li>
							</ul>
						</div>
					</section>

			</div>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollzer.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="assets/js/main.js"></script>

	</body>
</html>
